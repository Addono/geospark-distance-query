{"paragraphs":[{"text":"%spark.dep\n\nz.reset()\n\nz.load(\"org.datasyslab:geospark:1.3.1\")\nz.load(\"org.datasyslab:geospark-sql_2.3:1.3.1\")","user":"anonymous","dateUpdated":"2020-04-06T16:00:33+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res0: org.apache.zeppelin.dep.Dependency = org.apache.zeppelin.dep.Dependency@251ebc2e\n"}]},"apps":[],"jobName":"paragraph_1586177001624_-70649484","id":"20200406-124321_1045963472","dateCreated":"2020-04-06T12:43:21+0000","dateStarted":"2020-04-06T15:03:49+0000","dateFinished":"2020-04-06T15:03:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:7092"},{"text":"%spark\n\n// Define the location of the input file\nval file = \"gs://dataproc-staging-europe-west1-257466866150-2sydkcvg/points.csv\"","user":"anonymous","dateUpdated":"2020-04-06T16:05:58+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+---------+----------+\n|       _c0|      _c1|       _c2|\n+----------+---------+----------+\n|-88.331492|32.324142|     hotel|\n|-88.175933|32.360763|       gas|\n|-88.388954|32.357073|       bar|\n|-88.221102| 32.35078|restaurant|\n+----------+---------+----------+\n\ndf: org.apache.spark.sql.DataFrame = [_c0: string, _c1: string ... 1 more field]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=25","http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=26"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1586183653424_-2054811547","id":"20200406-143413_1703696930","dateCreated":"2020-04-06T14:34:13+0000","dateStarted":"2020-04-06T15:34:51+0000","dateFinished":"2020-04-06T15:34:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7094"},{"text":"%spark\n\n// Preview the data such that we know what we're dealing with\nval df = spark.read.csv(file)\n\ndf.show()","user":"anonymous","dateUpdated":"2020-04-06T16:05:45+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1586189139787_872629360","id":"20200406-160539_1057213736","dateCreated":"2020-04-06T16:05:39+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:7095"},{"text":"%spark\n\n// Import the dataset as a pointRDD\n\nimport org.datasyslab.geospark.enums.FileDataSplitter\nimport org.datasyslab.geospark.spatialRDD.PointRDD\n\nval offset = 0\nval splitter = FileDataSplitter.CSV\nval carryOtherAttributes = true\n\nval pointsRDD = new PointRDD(sc, file, offset, splitter, carryOtherAttributes)","user":"anonymous","dateUpdated":"2020-04-06T16:07:06+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.datasyslab.geospark.enums.FileDataSplitter\nimport org.datasyslab.geospark.spatialRDD.PointRDD\ninputLocation: String = gs://dataproc-staging-europe-west1-257466866150-2sydkcvg/points.csv\noffset: Int = 0\nsplitter: org.datasyslab.geospark.enums.FileDataSplitter = CSV\ncarryOtherAttributes: Boolean = true\npointsRDD: org.datasyslab.geospark.spatialRDD.PointRDD = org.datasyslab.geospark.spatialRDD.PointRDD@6e8a3a74\n"}]},"apps":[],"jobName":"paragraph_1586184222528_12497609","id":"20200406-144342_1807512233","dateCreated":"2020-04-06T14:43:42+0000","dateStarted":"2020-04-06T15:28:31+0000","dateFinished":"2020-04-06T15:28:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7096"},{"text":"%spark\n\n// Prepare the spatial partitioning join to find which nodes are close to each other\n\npointsRDD.analyze()\n\nimport org.datasyslab.geospark.spatialRDD.CircleRDD\nimport org.datasyslab.geospark.enums.GridType\n\nval circleRDD = new CircleRDD(pointsRDD, 0.1)  // Set the boundary to 0.1 radian\ncircleRDD.analyze()\ncircleRDD.spatialPartitioning(GridType.KDBTREE)\n\npointsRDD.spatialPartitioning(circleRDD.getPartitioner)","user":"anonymous","dateUpdated":"2020-04-06T16:08:16+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.datasyslab.geospark.spatialRDD.CircleRDD\nimport org.datasyslab.geospark.enums.GridType\ncircleRDD: org.datasyslab.geospark.spatialRDD.CircleRDD = org.datasyslab.geospark.spatialRDD.CircleRDD@112301d6\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=43","http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=44","http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=45"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1586185526673_448234492","id":"20200406-150526_1301895395","dateCreated":"2020-04-06T15:05:26+0000","dateStarted":"2020-04-06T15:59:45+0000","dateFinished":"2020-04-06T15:59:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7097"},{"text":"%spark\n\n// Execute the distance join\n\nimport org.datasyslab.geospark.spatialOperator.JoinQuery\n\nval considerBoundaryIntersection = false\nval usingIndex = false\n\nval resultAsJavaPairRDD = JoinQuery.DistanceJoinQueryFlat(pointsRDD, circleRDD, usingIndex, considerBoundaryIntersection)\n\n// Convert the value to a Scala native version\nimport org.apache.spark.api.java.JavaPairRDD\n\nval result = JavaPairRDD.toRDD(resultAsJavaPairRDD)","user":"anonymous","dateUpdated":"2020-04-06T16:09:07+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.datasyslab.geospark.spatialOperator.JoinQuery\nconsiderBoundaryIntersection: Boolean = false\nusingIndex: Boolean = false\nresultAsJavaPairRDD: org.apache.spark.api.java.JavaPairRDD[com.vividsolutions.jts.geom.Geometry,com.vividsolutions.jts.geom.Point] = org.apache.spark.api.java.JavaPairRDD@74b9e6e2\nimport org.apache.spark.api.java.JavaPairRDD\nresult: org.apache.spark.rdd.RDD[(com.vividsolutions.jts.geom.Geometry, com.vividsolutions.jts.geom.Point)] = MapPartitionsRDD[157] at mapToPair at JoinQuery.java:429\n"}]},"apps":[],"jobName":"paragraph_1586186100291_239297697","id":"20200406-151500_1253876893","dateCreated":"2020-04-06T15:15:00+0000","dateStarted":"2020-04-06T16:09:07+0000","dateFinished":"2020-04-06T16:09:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7098"},{"text":"%spark\n\n// Show a sample of the data\nresult.take(10).foreach { println }\n\nprintln(\"Total amount of results: \" + result.count + \" (Note: This includes self-matches)\")","user":"anonymous","dateUpdated":"2020-04-06T16:21:16+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"(POINT (-88.331492 32.324142)\thotel,POINT (-88.331492 32.324142)\thotel)\n(POINT (-88.331492 32.324142)\thotel,POINT (-88.388954 32.357073)\tbar)\n(POINT (-88.388954 32.357073)\tbar,POINT (-88.331492 32.324142)\thotel)\n(POINT (-88.388954 32.357073)\tbar,POINT (-88.388954 32.357073)\tbar)\n(POINT (-88.175933 32.360763)\tgas,POINT (-88.175933 32.360763)\tgas)\n(POINT (-88.175933 32.360763)\tgas,POINT (-88.221102 32.35078)\trestaurant)\n(POINT (-88.221102 32.35078)\trestaurant,POINT (-88.175933 32.360763)\tgas)\n(POINT (-88.221102 32.35078)\trestaurant,POINT (-88.221102 32.35078)\trestaurant)\nTotal amount of results: 8 (Note: This includes self-matches)\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=86","http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=87","http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=88"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1586186917905_1734565492","id":"20200406-152837_1603792660","dateCreated":"2020-04-06T15:28:37+0000","dateStarted":"2020-04-06T16:21:16+0000","dateFinished":"2020-04-06T16:21:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7099"},{"text":"%spark\n\n// Filter out self-matches and compute the distance between points\nval resultsWithDistance = result\n    .filter { case (from, to) => (from.getUserData() != to.getUserData()) } // Filter out all self-matches\n    .map{ case (from, to) => (from, to, from.distance(to))} // Compute the distance between all points\n    ","user":"anonymous","dateUpdated":"2020-04-06T16:19:32+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"resultsWithDistance: org.apache.spark.rdd.RDD[(com.vividsolutions.jts.geom.Geometry, com.vividsolutions.jts.geom.Point, Double)] = MapPartitionsRDD[159] at map at <console>:73\n"}]},"apps":[],"jobName":"paragraph_1586186948213_-793853225","id":"20200406-152908_673523116","dateCreated":"2020-04-06T15:29:08+0000","dateStarted":"2020-04-06T16:19:32+0000","dateFinished":"2020-04-06T16:19:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7100"},{"text":"resultsWithDistance\n    .collect() // Collect all results on the master node\n    .foreach { println }","user":"anonymous","dateUpdated":"2020-04-06T16:20:43+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"4\n(POINT (-88.331492 32.324142)\thotel,POINT (-88.388954 32.357073)\tbar,0.06622939079441977)\n(POINT (-88.388954 32.357073)\tbar,POINT (-88.331492 32.324142)\thotel,0.06622939079441977)\n(POINT (-88.175933 32.360763)\tgas,POINT (-88.221102 32.35078)\trestaurant,0.04625904073800156)\n(POINT (-88.221102 32.35078)\trestaurant,POINT (-88.175933 32.360763)\tgas,0.04625904073800156)\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=81","http://cluster-a5ab-m.c.symmetric-ion-268111.internal:4040/jobs/job?id=82"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1586187000928_-1487631557","id":"20200406-153000_1099022015","dateCreated":"2020-04-06T15:30:00+0000","dateStarted":"2020-04-06T16:20:34+0000","dateFinished":"2020-04-06T16:20:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7101"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1586189985529_2071935100","id":"20200406-161945_745588718","dateCreated":"2020-04-06T16:19:45+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:7102"}],"name":"GeoSpark-distance-query","id":"2F7D7Y6DZ","noteParams":{},"noteForms":{},"angularObjects":{"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}